<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üñºÔ∏è OLA‚ÄôS Update ‚Äì Proof Generator</title>
  <style>
    * {
      box-sizing: border-box;
      user-select: none;
    }
    body {
      background: #121212;
      color: #ffffff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
      padding: 20px;
    }
    h2 {
      color: #ffcc00;
      margin-bottom: 10px;
      font-size: 26px;
    }
    input[type="file"], button {
      margin: 8px;
      padding: 12px 18px;
      font-size: 15px;
      border-radius: 8px;
      border: none;
      outline: none;
    }
    input[type="file"] {
      background-color: #333;
      color: #fefefe;
    }
    button {
      background-color: #ffcc00;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      transition: 0.2s ease-in-out;
    }
    button:hover {
      background-color: #ffda3a;
    }
    #canvasContainer {
      margin: 20px auto;
      position: relative;
      border: 2px dashed #ffcc00;
      border-radius: 12px;
      display: none;
      padding: 8px;
      overflow: hidden;
    }
    canvas {
      max-width: 100%;
      border-radius: 8px;
    }
    .draggable {
      position: absolute;
      cursor: move;
      z-index: 10;
      padding: 6px 10px;
      background-color: rgba(255,255,255,0.8);
      border-radius: 8px;
      font-weight: bold;
      color: #000;
    }
    #signature {
      width: 80px;
      height: 80px;
      touch-action: none;
      border-radius: 6px;
    }
    #footerNote {
      margin-top: 25px;
      font-size: 14px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <h2>OLA‚ÄôS Update ‚Äì Image Proof Maker ‚úÖ</h2>
  <input type="file" id="leftImg" accept="image/*">
  <input type="file" id="rightImg" accept="image/*"><br>
  <button onclick="generateCanvas()">üß© Generate Layout</button>
  <button onclick="downloadImage()">‚¨áÔ∏è Download Final Image</button>

  <div id="canvasContainer">
    <canvas id="finalCanvas"></canvas>
    <div id="watermark" class="draggable">Verified by OLA‚ÄôS Update ‚úÖ</div>
    <img id="signature" class="draggable" src="sign.png" />
  </div>

  <p id="footerNote">Double-tap or pinch to zoom the signature. Drag watermark/signature to position them.</p>

  <script>
    let leftImage, rightImage;

    function makeDraggable(el) {
      let isDragging = false, offsetX = 0, offsetY = 0;

      const move = (e) => {
        if (!isDragging) return;
        const x = (e.clientX || e.touches?.[0]?.clientX) - offsetX;
        const y = (e.clientY || e.touches?.[0]?.clientY) - offsetY;
        el.style.left = `${x}px`;
        el.style.top = `${y}px`;
      };

      const stop = () => {
        isDragging = false;
        document.removeEventListener("mousemove", move);
        document.removeEventListener("mouseup", stop);
        document.removeEventListener("touchmove", move);
        document.removeEventListener("touchend", stop);
      };

      el.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        document.addEventListener("mousemove", move);
        document.addEventListener("mouseup", stop);
      });

      el.addEventListener("touchstart", (e) => {
        isDragging = true;
        const rect = el.getBoundingClientRect();
        offsetX = e.touches[0].clientX - rect.left;
        offsetY = e.touches[0].clientY - rect.top;
        document.addEventListener("touchmove", move, { passive: false });
        document.addEventListener("touchend", stop);
      });
    }

    makeDraggable(document.getElementById("watermark"));
    makeDraggable(document.getElementById("signature"));

    function loadImage(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => resolve(img);
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    async function generateCanvas() {
      const leftFile = document.getElementById("leftImg").files[0];
      const rightFile = document.getElementById("rightImg").files[0];
      if (!leftFile || !rightFile) return alert("üì∏ Please select both images.");

      leftImage = await loadImage(leftFile);
      rightImage = await loadImage(rightFile);

      const canvas = document.getElementById("finalCanvas");
      const ctx = canvas.getContext("2d");

      const width = leftImage.width + rightImage.width;
      const height = Math.max(leftImage.height, rightImage.height);
      canvas.width = width;
      canvas.height = height;

      ctx.drawImage(leftImage, 0, 0);
      ctx.drawImage(rightImage, leftImage.width, 0);

      const container = document.getElementById("canvasContainer");
      container.style.display = "inline-block";

      // Default watermark/signature positions
      document.getElementById("watermark").style.top = (height - 40) + "px";
      document.getElementById("watermark").style.left = "20px";

      document.getElementById("signature").style.top = "20px";
      document.getElementById("signature").style.left = (width - 100) + "px";
      document.getElementById("signature").style.transform = "scale(1)";
    }

    // Zoom and double-tap zoom
    (function enablePinchZoom() {
      const sig = document.getElementById("signature");
      let scale = 1, initialDist = null, baseScale = 1;
      let lastTap = 0;

      function distance(t1, t2) {
        const dx = t1.clientX - t2.clientX;
        const dy = t1.clientY - t2.clientY;
        return Math.sqrt(dx * dx + dy * dy);
      }

      sig.addEventListener("touchstart", (e) => {
        if (e.touches.length === 2) {
          e.preventDefault();
          initialDist = distance(e.touches[0], e.touches[1]);
        } else if (e.touches.length === 1) {
          const now = Date.now();
          if (now - lastTap < 300) {
            scale = scale === 1 ? 2 : 1;
            baseScale = scale;
            sig.style.transform = `scale(${scale})`;
          }
          lastTap = now;
        }
      }, { passive: false });

      sig.addEventListener("touchmove", (e) => {
        if (e.touches.length === 2 && initialDist !== null) {
          e.preventDefault();
          const currentDist = distance(e.touches[0], e.touches[1]);
          scale = baseScale * (currentDist / initialDist);
          sig.style.transform = `scale(${scale})`;
        }
      }, { passive: false });

      sig.addEventListener("touchend", () => {
        baseScale = scale;
        initialDist = null;
      });
    })();

    function downloadImage() {
      const canvas = document.getElementById("finalCanvas");
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(leftImage, 0, 0);
      ctx.drawImage(rightImage, leftImage.width, 0);

      const container = document.getElementById("canvasContainer");

      function drawElement(el, drawCallback) {
        const rect = el.getBoundingClientRect();
        const containerRect = container.getBoundingClientRect();
        const x = rect.left - containerRect.left;
        const y = rect.top - containerRect.top;
        drawCallback(x, y, el.offsetWidth, el.offsetHeight);
      }

      drawElement(document.getElementById("watermark"), (x, y) => {
        ctx.font = "20px Arial";
        ctx.fillStyle = "rgba(0, 0, 0, 0.75)";
        ctx.fillText("Verified by OLA‚ÄôS Update ‚úÖ", x, y + 20);
      });

      const sig = document.getElementById("signature");
      const match = sig.style.transform.match(/scaleÓÄÅ([\d.]+)ÓÄÅ/);
      const scale = match ? parseFloat(match[1]) : 1;

      drawElement(sig, (x, y, w, h) => {
        ctx.drawImage(sig, x, y, w * scale, h * scale);
      });

      const link = document.createElement("a");
      link.download = "OLA-proof.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    }
  </script>
</body>
</html>
